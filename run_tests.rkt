#lang racket
(require "interpreter/interpreter.rkt")
(require "interpreter/simpleParser.rkt")
(require "interpreter/state.rkt")
(require "interpreter/mstate.rkt")

(define error_test_case
    (lambda (result expected)
        (newline)
        (display "error test case")
        (newline)
        (with-handlers ((exn:fail? (lambda (e) (display e)))) (result))
        (newline)
        (display " = ")
        (newline)
        (with-handlers ((exn:fail? (lambda (e) (display e)))) (expected))
        (newline)
        (newline)
    )
)

(define test_case
  (lambda (result expected)
    ;; <<result == expected>> <= <<result>> = <<expected>>\n
    (display (equal? result expected)) (display " <= ") (display result) (display " = ") (display expected) (newline)
  )
)

(newline)

(error_test_case (lambda () (interpret "test_cases/test11")) (lambda () (assign-error 'y)))
(error_test_case (lambda () (interpret "test_cases/test12")) (lambda () (undeclared-error 'x)))
(error_test_case (lambda () (interpret "test_cases/test13")) (lambda () (undefined-error 'x)))
(error_test_case (lambda () (interpret "test_cases/test14")) (lambda () (double-declare-error 'x)))
(error_test_case (lambda () (interpret "test_cases/test22")) (lambda () (multiple-returns-error)))
(error_test_case (lambda () (interpret "test_cases/test23")) (lambda () (boolean-mismatch-error 5)))
(error_test_case (lambda () (interpret "test_cases/test24")) (lambda () (boolean-mismatch-error 10)))
(error_test_case (lambda () (interpret "test_cases/test25")) (lambda () (undeclared-error 'return)))
;; TODO: fix these once you start testing
(error_test_case (lambda () (interpret "test_cases/test30")) (lambda () (undefined-op-error 'todo)))
(error_test_case (lambda () (interpret "test_cases/test36")) (lambda () (undefined-op-error 'todo)))
(error_test_case (lambda () (interpret "test_cases/test37")) (lambda () (undefined-op-error 'todo)))
(error_test_case (lambda () (interpret "test_cases/test38")) (lambda () (undefined-op-error 'todo)))
(error_test_case (lambda () (interpret "test_cases/test44")) (lambda () (undefined-op-error 'todo)))

(test_case (interpret "test_cases/test1")
           150)
(test_case (interpret "test_cases/test2")
           -4)
(test_case (interpret "test_cases/test3")
           10)
(test_case (interpret "test_cases/test4")
           16)
(test_case (interpret "test_cases/test5")
           220)
(test_case (interpret "test_cases/test6")
           5)
(test_case (interpret "test_cases/test7")
           6)
(test_case (interpret "test_cases/test8")
           10)
(test_case (interpret "test_cases/test9")
           5)
(test_case (interpret "test_cases/test10")
           -39)
(test_case (interpret "test_cases/test15")
           'true)
(test_case (interpret "test_cases/test16")
           100)
(test_case (interpret "test_cases/test17")
           'false)
(test_case (interpret "test_cases/test18")
           'true)
(test_case (interpret "test_cases/test19")
           128)
(test_case (interpret "test_cases/test20")
           12)
(test_case (interpret "test_cases/test21")
           100)
(test_case (interpret "test_cases/test26")
           20)
(test_case (interpret "test_cases/test27")
           164)
(test_case (interpret "test_cases/test28")
           32)
(test_case (interpret "test_cases/test29")
           2)
(test_case (interpret "test_cases/test31")
           25)
(test_case (interpret "test_cases/test32")
           21)
(test_case (interpret "test_cases/test33")
           6)
(test_case (interpret "test_cases/test34")
           -1)
(test_case (interpret "test_cases/test35")
           789)
(test_case (interpret "test_cases/test39")
           12)
(test_case (interpret "test_cases/test40")
           125)
(test_case (interpret "test_cases/test41")
           110)
(test_case (interpret "test_cases/test42")
           2000400)
(test_case (interpret "test_cases/test43")
           101)